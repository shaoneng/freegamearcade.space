name: Daily AI-Powered Game Scraper and Deploy

on:
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 1 * * *' # æ¯å¤©UTCæ—¶é—´1ç‚¹è¿è¡Œ

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    # --- å…³é”®ä¿®å¤: æˆäºˆå·¥ä½œæµå†™å…¥æƒé™ ---
    # é»˜è®¤æƒ…å†µä¸‹ï¼Œå·¥ä½œæµåªæœ‰è¯»å–æƒé™ã€‚
    # æˆ‘ä»¬éœ€è¦æ˜ç¡®æˆäºˆå®ƒ 'contents: write' æƒé™ï¼Œ
    # è¿™æ ·å®ƒæ‰èƒ½å°†ç”Ÿæˆçš„ç½‘ç«™æ¨é€åˆ° gh-pages åˆ†æ”¯ã€‚
    permissions:
      contents: write
    # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿Pythonè„šæœ¬å¯ä»¥è®¿é—®APIå¯†é’¥
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      - name: Set up Python ğŸ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies ğŸ“¦
        run: |
          python -m pip install --upgrade pip
          # æ–°å¢ google-generativeai ä¾èµ–
          pip install requests beautifulsoup4 google-generativeai

      - name: Run Scraper and AI Page Generator ğŸƒ
        # Pythonè„šæœ¬å°†é€šè¿‡ os.getenv("GEMINI_API_KEY") è‡ªåŠ¨è·å–å¯†é’¥
        run: python main.py

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          # æ·»åŠ æ‰€æœ‰æ–°ç”Ÿæˆæˆ–ä¿®æ”¹çš„æ–‡ä»¶
          git add .
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å˜åŠ¨ï¼Œåªæœ‰åœ¨æœ‰å˜åŠ¨æ—¶æ‰æäº¤
          if ! git diff-index --quiet HEAD; then
            git commit -m "Automated build: Update game data and pages"
            git push origin main
          else
            echo "No changes to commit."
