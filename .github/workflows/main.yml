name: Daily AI-Powered Game Scraper and Deploy

on:
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 1 * * *' # æ¯å¤©UTCæ—¶é—´1ç‚¹è¿è¡Œ

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿Pythonè„šæœ¬å¯ä»¥è®¿é—®APIå¯†é’¥
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      - name: Set up Python ğŸ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies ğŸ“¦
        run: |
          python -m pip install --upgrade pip
          # æ–°å¢ google-generativeai ä¾èµ–
          pip install requests beautifulsoup4 google-generativeai

      - name: Run Scraper and AI Page Generator ğŸƒ
        # Pythonè„šæœ¬å°†é€šè¿‡ os.getenv("GEMINI_API_KEY") è‡ªåŠ¨è·å–å¯†é’¥
        run: python main.py

      - name: Commit data files ğŸ’¾
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add games_archive.json processed_games.txt
          git diff --staged --quiet || git commit -m "chore: æ›´æ–°æ¸¸æˆæ•°æ®åº“"
          git push origin main || echo "No changes to commit"

      - name: Deploy to GitHub Pages ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages # éƒ¨ç½²åˆ°çš„åˆ†æ”¯
          folder: generated_pages # è¦éƒ¨ç½²çš„æ–‡ä»¶å¤¹
          clean: true
